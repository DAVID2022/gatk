package org.broadinstitute.hellbender.tools.walkers.annotator;

import com.google.common.collect.ImmutableMap;
import htsjdk.samtools.TextCigarCodec;
import htsjdk.variant.variantcontext.Allele;
import htsjdk.variant.variantcontext.GenotypesContext;
import htsjdk.variant.variantcontext.VariantContext;
import htsjdk.variant.variantcontext.VariantContextBuilder;
import htsjdk.variant.vcf.VCFConstants;
import org.broadinstitute.hellbender.engine.ReferenceContext;
import org.broadinstitute.hellbender.utils.genotyper.*;
import org.broadinstitute.hellbender.utils.read.ArtificialReadUtils;
import org.broadinstitute.hellbender.utils.read.GATKRead;
import org.broadinstitute.hellbender.testutils.ArtificialAnnotationUtils;
import org.broadinstitute.hellbender.GATKBaseTest;
import org.testng.Assert;
import org.testng.annotations.Test;

import java.util.*;
import java.util.stream.Collectors;
import java.util.stream.IntStream;

public final class CoverageUnitTest extends GATKBaseTest {

    private static final GATKRead makeRead() {
        return ArtificialReadUtils.createArtificialRead(TextCigarCodec.decode("10M"));
    }

    @Test(expectedExceptions = IllegalArgumentException.class)
    public void testAllNull() throws Exception {
        final VariantContext vc= null;
        final ReferenceContext referenceContext= null;
        final InfoFieldAnnotation cov = new Coverage();
        final Map<String, Object> annotate = cov.annotate(referenceContext, vc, null); //vc can't be null
    }

    @Test
    public void testDescriptions() throws Exception {
        final InfoFieldAnnotation cov = new Coverage();
        Assert.assertEquals(cov.getDescriptions().size(), 1);
        Assert.assertEquals(cov.getDescriptions().get(0).getID(), VCFConstants.DEPTH_KEY);
    }

    @Test
    public void testLikelihoodsEmpty() throws Exception {
        final List<GATKRead> reads = new ArrayList<>();
        final Map<String, List<GATKRead>> readsBySample = ImmutableMap.of("sample1", reads);
        final org.broadinstitute.hellbender.utils.genotyper.SampleList sampleList = new IndexedSampleList(Arrays.asList("sample1"));
        final AlleleList<Allele> alleleList = new IndexedAlleleList<>(Arrays.asList(Allele.NO_CALL));
        final AlleleLikelihoods<GATKRead, Allele> likelihoods = new AlleleLikelihoods<>(sampleList, alleleList, readsBySample);

        final VariantContext vc= makeVC();
        final ReferenceContext referenceContext= null;
        final Map<String, Object> annotate = new Coverage().annotate(referenceContext, vc, likelihoods);
        Assert.assertTrue(annotate.isEmpty());
    }

    private VariantContext makeVC() {
        final GenotypesContext testGC = GenotypesContext.create(2);
        final Allele refAllele = Allele.create("A", true);
        final Allele altAllele = Allele.create("T");

        return (new VariantContextBuilder())
                .alleles(Arrays.asList(refAllele, altAllele)).chr("1").start(15L).stop(15L).genotypes(testGC).make();
    }

    @Test
    public void test() {
        List<String> actual = Arrays.asList(new String[]{"HJYFJCCXX160204:4:1120:13088:62417 @ 51 = G Q10", "HJYFJCCXX160204:4:1201:29477:45101 @ 101 = G Q30", "HJYFJCCXX160204:4:1222:26656:14617 @ 39 = G Q30", "HJYFJCCXX160204:4:2104:22648:49478 @ 58 = G Q30", "HJYFJCCXX160204:4:2106:19471:29806 @ 25 = G Q30", "HJYFJCCXX160204:4:2121:2483:10468 @ 9 = G Q30", "HJYFJCCXX160204:4:2123:1397:58233 @ 117 = G Q30", "HJYFJCCXX160204:4:2210:2037:6425 @ 16 = G Q30", "HJYFJCCXX160204:4:2219:24454:48353 @ 14 = G Q20", "HJYFJCCXX160204:4:2223:28869:22563 @ 116 = G Q30", "HJYFJCCXX160204:5:1107:25388:6020 @ 43 = G Q30", "HJYFJCCXX160204:5:1109:2909:71963 @ 98 = G Q30", "HJYFJCCXX160204:5:1111:21785:51430 @ 113 = G Q30", "HJYFJCCXX160204:5:1117:20923:39282 @ 28 = G Q30", "HJYFJCCXX160204:5:1118:25388:49267 @ 56 = G Q30", "HJYFJCCXX160204:5:1207:15544:68219 @ 38 = G Q30", "HJYFJCCXX160204:5:1210:23246:28435 @ 91 = G Q30", "HJYFJCCXX160204:5:2106:18355:70697 @ 90 = G Q30", "HJYFJCCXX160204:5:2224:29498:23513 @ 51 = G Q30", "HJYFJCCXX160204:6:1111:14022:16393 @ 47 = G Q30", "HJYFJCCXX160204:6:1202:22333:64017 @ 65 = G Q30", "HJYFJCCXX160204:6:1207:19999:63314 @ 67 = G Q30", "HJYFJCCXX160204:6:1212:6867:24145 @ 39 = G Q20", "HJYFJCCXX160204:6:2103:21836:45154 @ 149 = G Q2", "HJYFJCCXX160204:6:2219:3853:35168 @ 64 = G Q30", "HJYFJCCXX160204:7:1112:22059:17166 @ 124 = G Q30", "HJYFJCCXX160204:7:1117:9475:25077 @ 123 = G Q30", "HJYFJCCXX160204:7:1205:26413:3436 @ 25 = G Q30", "HJYFJCCXX160204:7:1214:15270:24005 @ 63 = G Q4", "HJYFJCCXX160204:7:1221:29183:43079 @ 39 = G Q30", "HJYFJCCXX160204:7:2102:5842:30597 @ 49 = G Q30", "HJYFJCCXX160204:7:2108:2402:47878 @ 118 = G Q30", "HJYFJCCXX160204:7:2121:21207:53240 @ 129 = G Q20", "HJYFJCCXX160204:7:2216:8674:23372 @ 26 = G Q30", "HJYFJCCXX160204:7:2222:29274:34518 @ 13 = G Q30", "HJYFJCCXX160204:8:2108:26737:36030 @ 104 = G Q30", "HJYFJCCXX160204:8:2114:23439:29718 @ 39 = G Q30", "HJYFJCCXX160204:8:2118:29630:50709 @ 51 = G Q30", "HJYFJCCXX160204:8:2119:18254:41796 @ 122 = G Q30", "HJYFJCCXX160204:8:2203:16670:35151 @ 65 = G Q20", "HJYN2CCXX160123:1:1122:26423:22968 @ 68 = G Q30", "HJYN2CCXX160123:1:1124:27559:6091 @ 97 = G Q30", "HJYN2CCXX160123:1:1211:31132:47228 @ 40 = G Q30", "HJYN2CCXX160123:1:1211:31132:47228 @ 96 = G Q30", "HJYN2CCXX160123:1:1214:24809:62505 @ 9 = G Q30", "HJYN2CCXX160123:1:2103:31538:40442 @ 14 = G Q30", "HJYN2CCXX160123:1:2211:11424:72086 @ 86 = G Q30", "HJYN2CCXX160123:1:2216:16630:62540 @ 50 = G Q30", "HK35MCCXX160204:1:1106:23023:69291 @ 22 = G Q30", "HK35MCCXX160204:1:1208:7791:44767 @ 103 = G Q30", "HK35MCCXX160204:1:1212:11150:55579 @ 73 = G Q30", "HK35MCCXX160204:1:1215:13545:53399 @ 28 = G Q30", "HK35MCCXX160204:1:2112:24809:30756 @ 7 = G Q30", "HK35MCCXX160204:1:2204:19035:72473 @ 65 = G Q30", "HK35MCCXX160204:2:1119:7415:18907 @ 72 = G Q30", "HK35MCCXX160204:2:1124:26616:60044 @ 5 = G Q30", "HK35MCCXX160204:2:1219:12621:46876 @ 100 = G Q30", "HK35MCCXX160204:2:1224:5416:48283 @ 91 = G Q30", "HK35MCCXX160204:2:2111:10368:24269 @ 94 = G Q30", "HK35MCCXX160204:2:2113:13382:58005 @ 123 = G Q30", "HK35MCCXX160204:2:2204:4645:63050 @ 95 = G Q30", "HK35MCCXX160204:2:2205:4949:35801 @ 105 = G Q30", "HK35MCCXX160204:2:2224:24951:51922 @ 65 = G Q30", "HK35MCCXX160204:3:1103:4645:32812 @ 26 = G Q30", "HK35MCCXX160204:3:1106:25337:28716 @ 69 = G Q30", "HK35MCCXX160204:3:1111:19471:7515 @ 122 = G Q30", "HK35MCCXX160204:3:1120:29640:41655 @ 126 = G Q30", "HK35MCCXX160204:3:1201:16051:58022 @ 137 = G Q30", "HK35MCCXX160204:3:2103:24200:22493 @ 93 = G Q20", "HK35MCCXX160204:3:2104:8603:21737 @ 23 = G Q30", "HK35MCCXX160204:3:2105:5964:59182 @ 121 = G Q30", "HK35MCCXX160204:3:2107:25905:28751 @ 53 = G Q30", "HK35MCCXX160204:3:2113:30117:29894 @ 110 = G Q2", "HK35MCCXX160204:3:2120:18132:59235 @ 33 = G Q30", "HK35MCCXX160204:3:2207:12834:10187 @ 61 = G Q30", "HK35MCCXX160204:3:2220:28879:53416 @ 56 = G Q20", "HK35MCCXX160204:3:2222:19705:48283 @ 34 = G Q30", "HK35MCCXX160204:4:1105:18913:62980 @ 76 = G Q30", "HK35MCCXX160204:4:1123:25753:45013 @ 22 = G Q30", "HK35MCCXX160204:4:1123:32258:65775 @ 86 = G Q30", "HK35MCCXX160204:4:2103:21379:21930 @ 74 = G Q20", "HK35MCCXX160204:4:2209:10155:72666 @ 36 = G Q30", "HK35MCCXX160204:4:2210:27915:10996 @ 101 = G Q30", "HK35MCCXX160204:4:2218:25296:68342 @ 34 = G Q20", "HK35MCCXX160204:5:1111:12195:67164 @ 41 = G Q30", "HK35MCCXX160204:5:2106:13108:9642 @ 49 = G Q30", "HK35MCCXX160204:5:2110:23642:6935 @ 36 = G Q30", "HK35MCCXX160204:5:2116:29833:26167 @ 64 = G Q30", "HK35MCCXX160204:5:2117:11495:54031 @ 21 = G Q6", "HK35MCCXX160204:5:2117:11495:54031 @ 80 = G Q30", "HK35MCCXX160204:5:2117:24890:41409 @ 20 = G Q20", "HK35MCCXX160204:5:2219:10906:22704 @ 23 = G Q30", "HK35MCCXX160204:6:1207:20577:24093 @ 44 = G Q30", "HK35MCCXX160204:6:1207:20577:24093 @ 97 = G Q30", "HK35MCCXX160204:6:1222:4229:46015 @ 69 = G Q20", "HK35MCCXX160204:6:2104:2798:51764 @ 89 = G Q30", "HK35MCCXX160204:6:2109:20994:31424 @ 138 = G Q30", "HK35MCCXX160204:6:2209:1377:53311 @ 57 = G Q30", "HK35MCCXX160204:6:2215:23125:22458 @ 69 = G Q30", "HK35MCCXX160204:6:2219:7456:71260 @ 56 = G Q30", "HK35MCCXX160204:6:2223:11941:41374 @ 9 = G Q30", "HK35MCCXX160204:6:2224:3194:43905 @ 87 = G Q5", "HK35MCCXX160204:7:1105:2169:36926 @ 83 = G Q6", "HK35MCCXX160204:7:1203:17584:53715 @ 150 = G Q30", "HK35MCCXX160204:7:1204:9658:52889 @ 54 = G Q30", "HK35MCCXX160204:7:1210:3244:59323 @ 87 = G Q30", "HK35MCCXX160204:7:1212:22638:28611 @ 58 = G Q30", "HK35MCCXX160204:7:1220:13220:69115 @ 50 = G Q20", "HK35MCCXX160204:7:2113:4594:69713 @ 67 = G Q30", "HK35MCCXX160204:7:2115:11008:45101 @ 6 = G Q30", "HK35MCCXX160204:7:2208:28858:43466 @ 149 = G Q30", "HK35MCCXX160204:7:2210:26271:38034 @ 42 = G Q30", "HK35MCCXX160204:7:2212:15402:40688 @ 87 = G Q30", "HK35MCCXX160204:7:2213:27306:41268 @ 66 = G Q30", "HK35MCCXX160204:7:2219:2483:43800 @ 109 = G Q30", "HK35MCCXX160204:7:2224:25784:49742 @ 13 = G Q30", "HK35MCCXX160204:8:1112:18639:62048 @ 8 = G Q2", "HK35MCCXX160204:8:1120:15534:21719 @ 38 = G Q20", "HK35MCCXX160204:8:1123:26859:8253 @ 59 = G Q30", "HK35MCCXX160204:8:1124:9475:51764 @ 41 = G Q30", "HK35MCCXX160204:8:1201:3823:46894 @ 63 = G Q30", "HK35MCCXX160204:8:1213:23216:49619 @ 124 = G Q30", "HK35MCCXX160204:8:2108:31680:13193 @ 87 = G Q20", "HK35MCCXX160204:8:2117:7486:63788 @ 78 = G Q30", "HK35MCCXX160204:8:2119:12702:5001 @ 72 = G Q30", "HK35MCCXX160204:8:2203:27032:24901 @ 132 = G Q30", "HK35MCCXX160204:8:2209:31812:30263 @ 96 = G Q20", "HK35MCCXX160204:8:2214:27032:23565 @ 48 = G Q30", "HK35MCCXX160204:8:2218:17269:6864 @ 32 = G Q30", "HK35NCCXX160204:1:1118:25225:46630 @ 111 = G Q2", "HK35NCCXX160204:1:1203:2970:41655 @ 61 = G Q30", "HK35NCCXX160204:1:1217:2635:24304 @ 120 = G Q30", "HK35NCCXX160204:1:1223:13301:62294 @ 25 = G Q30", "HK35NCCXX160204:1:2101:18274:26642 @ 126 = G Q10", "HK35NCCXX160204:1:2102:14275:6741 @ 69 = G Q30", "HK35NCCXX160204:1:2210:21207:27292 @ 60 = G Q30", "HK35NCCXX160204:1:2224:23632:68131 @ 46 = G Q30", "HK35NCCXX160204:2:1107:5213:66320 @ 19 = G Q30", "HK35NCCXX160204:2:1108:7182:3559 @ 36 = G Q30", "HK35NCCXX160204:2:1122:5720:1344 @ 96 = G Q30", "HK35NCCXX160204:2:1204:21207:15162 @ 35 = G Q20", "HK35NCCXX160204:2:1205:15919:19926 @ 103 = G Q30", "HK35NCCXX160204:2:1212:19867:39774 @ 78 = G Q30", "HK35NCCXX160204:2:2110:10845:57618 @ 1 = G Q2", "HK35NCCXX160204:2:2115:1702:39633 @ 88 = G Q6", "HK3T5CCXX160204:1:1101:4198:33656 @ 46 = G Q30", "HK3T5CCXX160204:1:1119:17391:36575 @ 1 = G Q2", "HK3T5CCXX160204:1:1119:17391:36575 @ 92 = G Q30", "HK3T5CCXX160204:1:1206:5720:25886 @ 115 = G Q30", "HK3T5CCXX160204:1:1209:10206:57495 @ 94 = G Q30", "HK3T5CCXX160204:1:1217:10916:53768 @ 40 = G Q30", "HK3T5CCXX160204:1:1224:23551:14265 @ 63 = G Q30", "HK3T5CCXX160204:1:2113:32441:27029 @ 51 = G Q2", "HK3T5CCXX160204:1:2115:29894:4755 @ 66 = G Q30", "HK3T5CCXX160204:1:2121:13078:41233 @ 24 = G Q30", "HK3T5CCXX160204:1:2207:23855:46894 @ 104 = G Q30", "HK3T5CCXX160204:1:2207:9496:21421 @ 40 = G Q30", "HK3T5CCXX160204:1:2215:26047:46894 @ 140 = G Q30", "HK3T5CCXX160204:1:2215:26047:46894 @ 61 = G Q30", "HK3T5CCXX160204:1:2221:11525:69344 @ 17 = G Q30", "HK3T5CCXX160204:1:2222:11576:61837 @ 94 = G Q30", "HK3T5CCXX160204:1:2224:10389:64667 @ 143 = G Q30", "HK3T5CCXX160204:2:1111:17685:24181 @ 98 = G Q30", "HK3T5CCXX160204:2:1121:11830:40512 @ 41 = G Q30", "HK3T5CCXX160204:2:2110:28706:27380 @ 89 = G Q30", "HK3T5CCXX160204:2:2219:19837:2768 @ 20 = G Q30", "HK3T5CCXX160204:3:1107:22029:54418 @ 64 = G Q30", "HK3T5CCXX160204:3:1114:29254:72315 @ 3 = G Q20", "HK3T5CCXX160204:3:1123:18690:14178 @ 70 = G Q20", "HK3T5CCXX160204:3:1204:5315:44486 @ 25 = G Q30", "HK3T5CCXX160204:3:2107:6583:7023 @ 140 = G Q30", "HK3T5CCXX160204:3:2109:7923:2557 @ 39 = G Q30", "HK3T5CCXX160204:3:2111:10886:54348 @ 22 = G Q30", "HK3T5CCXX160204:3:2115:30036:59815 @ 33 = G Q30", "HK3T5CCXX160204:3:2203:28615:46947 @ 134 = G Q30", "HK3T5CCXX160204:3:2218:24596:72121 @ 16 = G Q30", "HK3T5CCXX160204:3:2220:28777:69449 @ 58 = G Q6", "HK3T5CCXX160204:4:1110:14834:36961 @ 105 = G Q30", "HK3T5CCXX160204:4:1110:14834:36961 @ 72 = G Q30", "HK3T5CCXX160204:4:1224:28290:53065 @ 26 = G Q30", "HK3T5CCXX160204:4:2111:22221:45927 @ 8 = G Q30", "HK3T5CCXX160204:4:2111:5172:12314 @ 80 = G Q30", "HK3T5CCXX160204:4:2118:12946:22546 @ 37 = G Q30", "HK3T5CCXX160204:4:2121:13403:53258 @ 7 = G Q30", "HK3T5CCXX160204:4:2122:21684:55368 @ 15 = G Q30", "HK3T5CCXX160204:5:1111:4868:32883 @ 65 = G Q30", "HK3T5CCXX160204:5:1116:4127:37190 @ 143 = G Q30", "HK3T5CCXX160204:5:2108:28635:26413 @ 96 = G Q30", "HK3T5CCXX160204:5:2121:3143:62523 @ 7 = G Q30", "HK3T5CCXX160204:5:2213:26271:9167 @ 5 = G Q30", "HK3T5CCXX160204:5:2213:26271:9167 @ 96 = G Q30", "HK3T5CCXX160204:5:2214:17401:33709 @ 75 = G Q30", "HK3T5CCXX160204:6:1202:4198:43044 @ 38 = G Q2", "HK3T5CCXX160204:6:1211:10734:14213 @ 46 = G Q30", "HK3T5CCXX160204:6:2108:10105:21456 @ 6 = G Q30", "HK3T5CCXX160204:6:2117:4533:23266 @ 74 = G Q30", "HK3T5CCXX160204:6:2117:4533:23266 @ 85 = G Q30", "HK3T5CCXX160204:6:2123:14884:32232 @ 75 = G Q30", "HK3T5CCXX160204:6:2124:3681:40214 @ 26 = G Q30", "HK3T5CCXX160204:6:2201:7070:48054 @ 106 = G Q30", "HK3T5CCXX160204:6:2213:15869:59393 @ 80 = G Q30", "HK3T5CCXX160204:7:1201:9861:28839 @ 52 = G Q30", "HK3T5CCXX160204:7:2105:2341:12050 @ 56 = G Q30", "HK3T5CCXX160204:7:2110:31578:15584 @ 48 = G Q30", "HK3T5CCXX160204:8:1116:25489:36715 @ 109 = G Q30", "HK3T5CCXX160204:8:1116:25489:36715 @ 144 = G Q30", "HK3T5CCXX160204:8:1120:28036:48793 @ 93 = G Q30", "HK3T5CCXX160204:8:1202:2179:9343 @ 142 = G Q2", "HK3T5CCXX160204:8:1214:18832:62030 @ 49 = G Q30", "HK3T5CCXX160204:8:2101:19522:69062 @ 29 = G Q30", "HK3T5CCXX160204:8:2108:1621:45997 @ 22 = G Q30", "HK3T5CCXX160204:8:2114:32106:68008 @ 12 = G Q20", "HK3T5CCXX160204:8:2204:15138:54541 @ 13 = G Q30", "HK3T5CCXX160204:8:2215:2087:49584 @ 32 = G Q30", "HK3T5CCXX160204:8:2224:16650:7972 @ 149 = G Q30"});
        List<String> expected = Arrays.asList(new String[]{"HJYFJCCXX160204:4:1120:13088:62417 @ 51 = G Q10", "HJYFJCCXX160204:4:1201:29477:45101 @ 101 = G Q30", "HJYFJCCXX160204:4:1222:26656:14617 @ 39 = G Q30", "HJYFJCCXX160204:4:2104:22648:49478 @ 58 = G Q30", "HJYFJCCXX160204:4:2106:19471:29806 @ 25 = G Q30", "HJYFJCCXX160204:4:2121:2483:10468 @ 9 = G Q30", "HJYFJCCXX160204:4:2123:1397:58233 @ 117 = G Q30", "HJYFJCCXX160204:4:2210:2037:6425 @ 16 = G Q30", "HJYFJCCXX160204:4:2219:24454:48353 @ 14 = G Q20", "HJYFJCCXX160204:4:2223:28869:22563 @ 116 = G Q30", "HJYFJCCXX160204:5:1107:25388:6020 @ 43 = G Q30", "HJYFJCCXX160204:5:1109:2909:71963 @ 98 = G Q30", "HJYFJCCXX160204:5:1111:21785:51430 @ 113 = G Q30", "HJYFJCCXX160204:5:1117:20923:39282 @ 28 = G Q30", "HJYFJCCXX160204:5:1118:25388:49267 @ 56 = G Q30", "HJYFJCCXX160204:5:1207:15544:68219 @ 38 = G Q30", "HJYFJCCXX160204:5:1210:23246:28435 @ 91 = G Q30", "HJYFJCCXX160204:5:2106:18355:70697 @ 90 = G Q30", "HJYFJCCXX160204:5:2224:29498:23513 @ 51 = G Q30", "HJYFJCCXX160204:6:1111:14022:16393 @ 47 = G Q30", "HJYFJCCXX160204:6:1202:22333:64017 @ 65 = G Q30", "HJYFJCCXX160204:6:1207:19999:63314 @ 67 = G Q30", "HJYFJCCXX160204:6:1212:6867:24145 @ 39 = G Q20", "HJYFJCCXX160204:6:2103:21836:45154 @ 149 = G Q2", "HJYFJCCXX160204:6:2219:3853:35168 @ 64 = G Q30", "HJYFJCCXX160204:7:1112:22059:17166 @ 124 = G Q30", "HJYFJCCXX160204:7:1117:9475:25077 @ 123 = G Q30", "HJYFJCCXX160204:7:1205:26413:3436 @ 25 = G Q30", "HJYFJCCXX160204:7:1214:15270:24005 @ 63 = G Q4", "HJYFJCCXX160204:7:1221:29183:43079 @ 39 = G Q30", "HJYFJCCXX160204:7:2102:5842:30597 @ 49 = G Q30", "HJYFJCCXX160204:7:2108:2402:47878 @ 118 = G Q30", "HJYFJCCXX160204:7:2121:21207:53240 @ 129 = G Q20", "HJYFJCCXX160204:7:2216:8674:23372 @ 26 = G Q30", "HJYFJCCXX160204:7:2222:29274:34518 @ 13 = G Q30", "HJYFJCCXX160204:8:2108:26737:36030 @ 104 = G Q30", "HJYFJCCXX160204:8:2114:23439:29718 @ 39 = G Q30", "HJYFJCCXX160204:8:2118:29630:50709 @ 51 = G Q30", "HJYFJCCXX160204:8:2119:18254:41796 @ 122 = G Q30", "HJYFJCCXX160204:8:2203:16670:35151 @ 65 = G Q20", "HJYN2CCXX160123:1:1122:26423:22968 @ 68 = G Q30", "HJYN2CCXX160123:1:1124:27559:6091 @ 97 = G Q30", "HJYN2CCXX160123:1:1211:31132:47228 @ 40 = G Q30", "HJYN2CCXX160123:1:1211:31132:47228 @ 96 = G Q30", "HJYN2CCXX160123:1:1214:24809:62505 @ 9 = G Q30", "HJYN2CCXX160123:1:2103:31538:40442 @ 14 = G Q30", "HJYN2CCXX160123:1:2211:11424:72086 @ 86 = G Q30", "HJYN2CCXX160123:1:2216:16630:62540 @ 50 = G Q30", "HK35MCCXX160204:1:1106:23023:69291 @ 22 = G Q30", "HK35MCCXX160204:1:1208:7791:44767 @ 103 = G Q30", "HK35MCCXX160204:1:1212:11150:55579 @ 73 = G Q30", "HK35MCCXX160204:1:1215:13545:53399 @ 28 = G Q30", "HK35MCCXX160204:1:2112:24809:30756 @ 7 = G Q30", "HK35MCCXX160204:1:2204:19035:72473 @ 65 = G Q30", "HK35MCCXX160204:2:1119:7415:18907 @ 72 = G Q30", "HK35MCCXX160204:2:1124:26616:60044 @ 5 = G Q30", "HK35MCCXX160204:2:1219:12621:46876 @ 100 = G Q30", "HK35MCCXX160204:2:1224:5416:48283 @ 91 = G Q30", "HK35MCCXX160204:2:2111:10368:24269 @ 94 = G Q30", "HK35MCCXX160204:2:2113:13382:58005 @ 123 = G Q30", "HK35MCCXX160204:2:2204:4645:63050 @ 95 = G Q30", "HK35MCCXX160204:2:2205:4949:35801 @ 105 = G Q30", "HK35MCCXX160204:2:2224:24951:51922 @ 65 = G Q30", "HK35MCCXX160204:3:1103:4645:32812 @ 26 = G Q30", "HK35MCCXX160204:3:1106:25337:28716 @ 69 = G Q30", "HK35MCCXX160204:3:1111:19471:7515 @ 122 = G Q30", "HK35MCCXX160204:3:1120:29640:41655 @ 126 = G Q30", "HK35MCCXX160204:3:1201:16051:58022 @ 137 = G Q30", "HK35MCCXX160204:3:2103:24200:22493 @ 93 = G Q20", "HK35MCCXX160204:3:2104:8603:21737 @ 23 = G Q30", "HK35MCCXX160204:3:2105:5964:59182 @ 121 = G Q30", "HK35MCCXX160204:3:2107:25905:28751 @ 53 = G Q30", "HK35MCCXX160204:3:2113:30117:29894 @ 110 = G Q2", "HK35MCCXX160204:3:2120:18132:59235 @ 33 = G Q30", "HK35MCCXX160204:3:2207:12834:10187 @ 61 = G Q30", "HK35MCCXX160204:3:2220:28879:53416 @ 56 = G Q20", "HK35MCCXX160204:3:2222:19705:48283 @ 34 = G Q30", "HK35MCCXX160204:4:1105:18913:62980 @ 76 = G Q30", "HK35MCCXX160204:4:1123:25753:45013 @ 22 = G Q30", "HK35MCCXX160204:4:1123:32258:65775 @ 86 = G Q30", "HK35MCCXX160204:4:2103:21379:21930 @ 74 = G Q20", "HK35MCCXX160204:4:2209:10155:72666 @ 36 = G Q30", "HK35MCCXX160204:4:2210:27915:10996 @ 101 = G Q30", "HK35MCCXX160204:4:2218:25296:68342 @ 34 = G Q20", "HK35MCCXX160204:5:1111:12195:67164 @ 41 = G Q30", "HK35MCCXX160204:5:2106:13108:9642 @ 49 = G Q30", "HK35MCCXX160204:5:2110:23642:6935 @ 36 = G Q30", "HK35MCCXX160204:5:2116:29833:26167 @ 64 = G Q30", "HK35MCCXX160204:5:2117:11495:54031 @ 21 = G Q6", "HK35MCCXX160204:5:2117:11495:54031 @ 80 = G Q30", "HK35MCCXX160204:5:2117:24890:41409 @ 20 = G Q20", "HK35MCCXX160204:5:2219:10906:22704 @ 23 = G Q30", "HK35MCCXX160204:6:1207:20577:24093 @ 44 = G Q30", "HK35MCCXX160204:6:1207:20577:24093 @ 97 = G Q30", "HK35MCCXX160204:6:1222:4229:46015 @ 69 = G Q20", "HK35MCCXX160204:6:2104:2798:51764 @ 89 = G Q30", "HK35MCCXX160204:6:2109:20994:31424 @ 138 = G Q30", "HK35MCCXX160204:6:2209:1377:53311 @ 57 = G Q30", "HK35MCCXX160204:6:2215:23125:22458 @ 69 = G Q30", "HK35MCCXX160204:6:2219:7456:71260 @ 56 = G Q30", "HK35MCCXX160204:6:2223:11941:41374 @ 9 = G Q30", "HK35MCCXX160204:6:2224:3194:43905 @ 87 = G Q5", "HK35MCCXX160204:7:1105:2169:36926 @ 83 = G Q6", "HK35MCCXX160204:7:1203:17584:53715 @ 150 = G Q30", "HK35MCCXX160204:7:1204:9658:52889 @ 54 = G Q30", "HK35MCCXX160204:7:1210:3244:59323 @ 87 = G Q30", "HK35MCCXX160204:7:1212:22638:28611 @ 58 = G Q30", "HK35MCCXX160204:7:1220:13220:69115 @ 50 = G Q20", "HK35MCCXX160204:7:2113:4594:69713 @ 67 = G Q30", "HK35MCCXX160204:7:2115:11008:45101 @ 6 = G Q30", "HK35MCCXX160204:7:2208:28858:43466 @ 149 = G Q30", "HK35MCCXX160204:7:2210:26271:38034 @ 42 = G Q30", "HK35MCCXX160204:7:2212:15402:40688 @ 87 = G Q30", "HK35MCCXX160204:7:2213:27306:41268 @ 66 = G Q30", "HK35MCCXX160204:7:2219:2483:43800 @ 109 = G Q30", "HK35MCCXX160204:7:2224:25784:49742 @ 13 = G Q30", "HK35MCCXX160204:8:1112:18639:62048 @ 8 = G Q2", "HK35MCCXX160204:8:1120:15534:21719 @ 38 = G Q20", "HK35MCCXX160204:8:1123:26859:8253 @ 59 = G Q30", "HK35MCCXX160204:8:1124:9475:51764 @ 41 = G Q30", "HK35MCCXX160204:8:1201:3823:46894 @ 63 = G Q30", "HK35MCCXX160204:8:1213:23216:49619 @ 124 = G Q30", "HK35MCCXX160204:8:2108:31680:13193 @ 87 = G Q20", "HK35MCCXX160204:8:2117:7486:63788 @ 78 = G Q30", "HK35MCCXX160204:8:2119:12702:5001 @ 72 = G Q30", "HK35MCCXX160204:8:2203:27032:24901 @ 132 = G Q30", "HK35MCCXX160204:8:2209:31812:30263 @ 96 = G Q20", "HK35MCCXX160204:8:2214:27032:23565 @ 48 = G Q30", "HK35MCCXX160204:8:2218:17269:6864 @ 32 = G Q30", "HK35NCCXX160204:1:1118:25225:46630 @ 111 = G Q2", "HK35NCCXX160204:1:1203:2970:41655 @ 61 = G Q30", "HK35NCCXX160204:1:1217:2635:24304 @ 120 = G Q30", "HK35NCCXX160204:1:1223:13301:62294 @ 25 = G Q30", "HK35NCCXX160204:1:2101:18274:26642 @ 126 = G Q10", "HK35NCCXX160204:1:2102:14275:6741 @ 69 = G Q30", "HK35NCCXX160204:1:2210:21207:27292 @ 60 = G Q30", "HK35NCCXX160204:1:2224:23632:68131 @ 46 = G Q30", "HK35NCCXX160204:2:1107:5213:66320 @ 19 = G Q30", "HK35NCCXX160204:2:1108:7182:3559 @ 36 = G Q30", "HK35NCCXX160204:2:1122:5720:1344 @ 96 = G Q30", "HK35NCCXX160204:2:1204:21207:15162 @ 35 = G Q20", "HK35NCCXX160204:2:1205:15919:19926 @ 103 = G Q30", "HK35NCCXX160204:2:1212:19867:39774 @ 78 = G Q30", "HK35NCCXX160204:2:2110:10845:57618 @ 1 = G Q2", "HK35NCCXX160204:2:2115:1702:39633 @ 88 = G Q6", "HK3T5CCXX160204:1:1101:4198:33656 @ 46 = G Q30", "HK3T5CCXX160204:1:1119:17391:36575 @ 1 = G Q2", "HK3T5CCXX160204:1:1119:17391:36575 @ 92 = G Q30", "HK3T5CCXX160204:1:1206:5720:25886 @ 115 = G Q30", "HK3T5CCXX160204:1:1209:10206:57495 @ 94 = G Q30", "HK3T5CCXX160204:1:1217:10916:53768 @ 40 = G Q30", "HK3T5CCXX160204:1:1224:23551:14265 @ 63 = G Q30", "HK3T5CCXX160204:1:2113:32441:27029 @ 51 = G Q2", "HK3T5CCXX160204:1:2115:29894:4755 @ 66 = G Q30", "HK3T5CCXX160204:1:2121:13078:41233 @ 24 = G Q30", "HK3T5CCXX160204:1:2207:23855:46894 @ 104 = G Q30", "HK3T5CCXX160204:1:2207:9496:21421 @ 40 = G Q30", "HK3T5CCXX160204:1:2215:26047:46894 @ 140 = G Q30", "HK3T5CCXX160204:1:2215:26047:46894 @ 61 = G Q30", "HK3T5CCXX160204:1:2221:11525:69344 @ 17 = G Q30", "HK3T5CCXX160204:1:2222:11576:61837 @ 94 = G Q30", "HK3T5CCXX160204:1:2224:10389:64667 @ 143 = G Q30", "HK3T5CCXX160204:2:1111:17685:24181 @ 98 = G Q30", "HK3T5CCXX160204:2:1121:11830:40512 @ 41 = G Q30", "HK3T5CCXX160204:2:2110:28706:27380 @ 89 = G Q30", "HK3T5CCXX160204:2:2219:19837:2768 @ 20 = G Q30", "HK3T5CCXX160204:3:1107:22029:54418 @ 64 = G Q30", "HK3T5CCXX160204:3:1114:29254:72315 @ 3 = G Q20", "HK3T5CCXX160204:3:1123:18690:14178 @ 70 = G Q20", "HK3T5CCXX160204:3:1204:5315:44486 @ 25 = G Q30", "HK3T5CCXX160204:3:2107:6583:7023 @ 140 = G Q30", "HK3T5CCXX160204:3:2109:7923:2557 @ 39 = G Q30", "HK3T5CCXX160204:3:2111:10886:54348 @ 22 = G Q30", "HK3T5CCXX160204:3:2115:30036:59815 @ 33 = G Q30", "HK3T5CCXX160204:3:2203:28615:46947 @ 134 = G Q30", "HK3T5CCXX160204:3:2218:24596:72121 @ 16 = G Q30", "HK3T5CCXX160204:3:2220:28777:69449 @ 58 = G Q6", "HK3T5CCXX160204:4:1110:14834:36961 @ 105 = G Q30", "HK3T5CCXX160204:4:1110:14834:36961 @ 72 = G Q30", "HK3T5CCXX160204:4:1224:28290:53065 @ 26 = G Q30", "HK3T5CCXX160204:4:2111:22221:45927 @ 8 = G Q30", "HK3T5CCXX160204:4:2111:5172:12314 @ 80 = G Q30", "HK3T5CCXX160204:4:2118:12946:22546 @ 37 = G Q30", "HK3T5CCXX160204:4:2121:13403:53258 @ 7 = G Q30", "HK3T5CCXX160204:4:2122:21684:55368 @ 15 = G Q30", "HK3T5CCXX160204:5:1111:4868:32883 @ 65 = G Q30", "HK3T5CCXX160204:5:1116:4127:37190 @ 143 = G Q30", "HK3T5CCXX160204:5:2108:28635:26413 @ 96 = G Q30", "HK3T5CCXX160204:5:2116:29295:39440 @ 16 = G Q2", "HK3T5CCXX160204:5:2121:3143:62523 @ 7 = G Q30", "HK3T5CCXX160204:5:2213:26271:9167 @ 5 = G Q30", "HK3T5CCXX160204:5:2213:26271:9167 @ 96 = G Q30", "HK3T5CCXX160204:5:2214:17401:33709 @ 75 = G Q30", "HK3T5CCXX160204:6:1202:4198:43044 @ 38 = G Q2", "HK3T5CCXX160204:6:1211:10734:14213 @ 46 = G Q30", "HK3T5CCXX160204:6:2108:10105:21456 @ 6 = G Q30", "HK3T5CCXX160204:6:2117:4533:23266 @ 74 = G Q30", "HK3T5CCXX160204:6:2117:4533:23266 @ 85 = G Q30", "HK3T5CCXX160204:6:2123:14884:32232 @ 75 = G Q30", "HK3T5CCXX160204:6:2124:3681:40214 @ 26 = G Q30", "HK3T5CCXX160204:6:2201:7070:48054 @ 106 = G Q30", "HK3T5CCXX160204:6:2213:15869:59393 @ 80 = G Q30", "HK3T5CCXX160204:7:1201:9861:28839 @ 52 = G Q30", "HK3T5CCXX160204:7:2105:2341:12050 @ 56 = G Q30", "HK3T5CCXX160204:7:2110:31578:15584 @ 48 = G Q30", "HK3T5CCXX160204:8:1116:25489:36715 @ 109 = G Q30", "HK3T5CCXX160204:8:1116:25489:36715 @ 144 = G Q30", "HK3T5CCXX160204:8:1120:28036:48793 @ 93 = G Q30", "HK3T5CCXX160204:8:1202:2179:9343 @ 142 = G Q2", "HK3T5CCXX160204:8:1214:18832:62030 @ 49 = G Q30", "HK3T5CCXX160204:8:2101:19522:69062 @ 29 = G Q30", "HK3T5CCXX160204:8:2108:1621:45997 @ 22 = G Q30", "HK3T5CCXX160204:8:2114:32106:68008 @ 12 = G Q20", "HK3T5CCXX160204:8:2204:15138:54541 @ 13 = G Q30", "HK3T5CCXX160204:8:2215:2087:49584 @ 32 = G Q30", "HK3T5CCXX160204:8:2224:16650:7972 @ 149 = G Q30"});
        for ( int i = 0; i < actual.size(); i++) {
            if (!actual.get(i).equalsIgnoreCase(expected.get(i))) {
                System.out.println(expected.get(i));
            }
        }
    }

    @Test
    public void testLikelihoods(){
        final Allele REF = Allele.create("T", true);
        final Allele ALT = Allele.create("A");

        final int refDepth= 5;
        final int altDepth= 3;
        final List<GATKRead>  refReads = IntStream.range(0, refDepth).mapToObj(n -> makeRead()).collect(Collectors.toList());
        final List<GATKRead>  altReads = IntStream.range(0, altDepth).mapToObj(n -> makeRead()).collect(Collectors.toList());
        final AlleleLikelihoods<GATKRead, Allele> likelihoods =
                ArtificialAnnotationUtils.makeLikelihoods("sample1", refReads, altReads, -100.0, -100.0, REF, ALT);

        final VariantContext vc= makeVC();
        final ReferenceContext referenceContext= null;
        final Map<String, Object> annotate = new Coverage().annotate(referenceContext, vc, likelihoods);
        Assert.assertEquals(annotate.size(), 1, "size");
        Assert.assertEquals(annotate.keySet(), Collections.singleton(VCFConstants.DEPTH_KEY), "annots");
        final int m = altDepth + refDepth;
        Assert.assertEquals(annotate.get(VCFConstants.DEPTH_KEY), String.valueOf(m));
    }
}
